var b=Object.defineProperty;var y=(h,t,o)=>t in h?b(h,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):h[t]=o;var p=(h,t,o)=>(y(h,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}})();class k{constructor(t,o,n,e,s,r){p(this,"outputElement");p(this,"previousClassName");this.accuracy=t,this.blockHeight=o,this.codeBlockMinWidth=n,this.codeBlockMaxWidth=e,this.spacing=s,this.monotype=r,this.monotype&&(this.accuracy=this.codeBlockMinWidth)}createFromImgTag(t,o){this.outputElement=this.getOutputElement(o);const n=this.getImageFromImgElement(t);this.createFromImage(n)}async createFromImageSrc(t,o){this.outputElement=this.getOutputElement(o);const n=await this.getImageFromSrc(t);this.createFromImage(n)}getOutputElement(t){const o=document.getElementById(t);if(!o)throw new Error("Could not get div");return o}getImageFromSrc(t){return new Promise((o,n)=>{const e=new Image;e.onload=()=>o(e),e.onerror=n,e.src=t})}getImageFromImgElement(t){const o=document.getElementById(t);if(!o)throw new Error("Could not get element");if(!(o instanceof HTMLImageElement))throw new Error("Element is not an image");return o}createFromImage(t){var c;const o=this.createContext(t.width,t.height);o.drawImage(t,0,0);const n=t.height/this.blockHeight,e=t.width/this.accuracy,s=this.splitIntoGrid(o,t.width,t.height,n,e,this.codeBlockMinWidth,this.codeBlockMaxWidth,this.monotype),r=this.generateCodeBlocks(s),i=this.createdOutputSVGElement(t.width,t.height);(c=i.getElementById("code-effect-group"))==null||c.append(...r),this.outputElement.appendChild(i)}createdOutputSVGElement(t,o){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");console.log("look here",n),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:svg","http://www.w3.org/2000/svg"),n.setAttribute("viewBox",`0 0 ${t} ${o}`);const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("id","code-effect-group"),n.appendChild(e),n}createContext(t,o){const n=document.createElement("canvas");n.width=t,n.height=o;const e=n.getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not get context");return e}splitIntoGrid(t,o,n,e,s,r,i,c){let l=0;const u=[];for(let d=0;d<e;d++){let a=0;const g=[];for(let w=0;w<s;w++){if(!this.areaContainsColour(t,a,l,this.accuracy,this.blockHeight)){g.push({startX:a,startY:l,fill:!1,blockWidth:this.accuracy,merged:!1}),a+=this.accuracy;continue}if(g.push({startX:a,startY:l,fill:!0,blockWidth:this.accuracy,merged:!1}),a+=this.accuracy,a>=o)break}if(u.push(g),l+=this.blockHeight,l>=n)break}this.mergeColumns(u);const m=[];for(const d of u){const a=d.filter(g=>!g.merged&&g.fill);m.push(a)}return this.splitIntoRandomLengthBlocks(m,r,i,c)}mergeColumns(t){for(let o=0;o<t.length;o++){let n=!1,e=0,s=-1;for(let r=0;r<t[o].length;r++){const i=t[o][r].fill;if(i&&n){const c=t[o][r];c.merged=!0;const l=t[o][s];l.blockWidth=e+this.accuracy,e=l.blockWidth,n=!0;continue}if(i){const c=t[o][r];s=r,e=c.blockWidth,n=!0,c.merged=!1;continue}e=0,n=!1,s=-1}}}splitIntoRandomLengthBlocks(t,o,n,e){const s=[];for(let r=0;r<t.length;r++){const i=[];for(let c=0;c<t[r].length;c++){const l=t[r][c].blockWidth,u=this.randomNumbersWithSum(l,o,n,e);let m=t[r][c].startX;for(let f=0;f<u.length;f++){const d=u[f],a={fill:!0,merged:!0,startY:t[r][c].startY,startX:m,blockWidth:d};m+=d,i.push(a)}}s.push(i)}return s}areaContainsColour(t,o,n,e,s){const r=t.getImageData(o,n+Math.floor(s/2),e,1).data;let i=!1;for(let c=0;c<r.length;c+=4){const l=r[c],u=r[c+1],m=r[c+2];if(r[c+3]!==0&&(l<255||u<255||m<255)){i=!0;break}}return i}generateCodeBlocks(t){const o=[];for(let n=0;n<t.length;n++)for(let e=0;e<t[n].length;e++)if(t[n][e].fill){const r=this.createRectangle(t[n][e].startX,t[n][e].startY,t[n][e].blockWidth,this.blockHeight,this.codeBlockMinWidth,this.codeBlockMaxWidth);o.push(r)}return o}createRectangle(t,o,n,e,s,r){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width",(n-this.spacing).toString()),i.setAttribute("height",(e-this.spacing).toString()),i.setAttribute("x",t.toString()),i.setAttribute("y",o.toString());const c=this.calculateRectClassName(n,s,r);return i.setAttribute("class",c),i}calculateRectClassName(t,o,n){let e="";do{if(t===o){e=this.chooseRandomString(["parenthesis","space"]);continue}if(t===n){e=this.chooseRandomString(["comment","function"]);continue}e=this.chooseRandomString(["access-modifier","primitive-type","conditional-statement","jump-statement","variable-declaration-const","variable-declaration-let"])}while(this.previousClassName===e);return this.previousClassName=e,e}chooseRandomString(t){const o=Math.floor(Math.random()*t.length);return t[o]}randomNumbersWithSum(t,o,n,e){let s=[];if(e){const c=Math.floor(t/o);s=Array.from(Array(c).keys()).map(l=>l*o)}else s=Array.from(Array(t).keys());const r=[];let i=t;for(;i>o;){if(i<o*2){r.push(i);break}const c=this.generateRandomNumber(s,o,n);r.push(c),i-=c}return r}generateRandomNumber(t,o,n){let e;do{const s=Math.floor(Math.random()*t.length);e=t[s]}while(e<o||e>n);return e}}const C=1,I=5,E=5,v=30,x=2,S=new k(C,I,E,v,x,!0);S.createFromImgTag("input","output");
