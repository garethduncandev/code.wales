var b=Object.defineProperty;var y=(a,t,o)=>t in a?b(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;var p=(a,t,o)=>(y(a,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();function k(a){return new Promise((t,o)=>{a.onload=()=>{t(a)},a.onerror=o})}class C{constructor(t,o,s,e,r,n){p(this,"div");p(this,"previousClassName");this.accuracy=t,this.blockHeight=o,this.codeBlockMinWidth=s,this.codeBlockMaxWidth=e,this.spacing=r,this.monotype=n,this.monotype&&(this.accuracy=this.codeBlockMinWidth)}async createFromImageSrc(t,o){const s=document.getElementById(o);if(!s)throw new Error("Could not get div");this.div=s;const e=new Image;e.src=t,await k(e),this.createFromImage(e)}createFromImage(t){var c;const o=this.createContext(t.width,t.height);o.drawImage(t,0,0);const s=t.height/this.blockHeight,e=t.width/this.accuracy,r=this.splitIntoGrid(o,t.width,t.height,s,e,this.codeBlockMinWidth,this.codeBlockMaxWidth,this.monotype),n=this.generateCodeBlocks(r),i=this.createdOutputSVGElement(t.width,t.height);(c=i.getElementById("code-effect-group"))==null||c.append(...n),this.div.appendChild(i)}createdOutputSVGElement(t,o){const s=document.createElementNS("http://www.w3.org/2000/svg","svg");console.log("look here",s),s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("xmlns:svg","http://www.w3.org/2000/svg"),s.setAttribute("viewBox",`0 0 ${t} ${o}`);const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("id","code-effect-group"),s.appendChild(e),s}createContext(t,o){const s=document.createElement("canvas");s.width=t,s.height=o;const e=s.getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not get context");return e}splitIntoGrid(t,o,s,e,r,n,i,c){let l=0;const u=[];for(let m=0;m<e;m++){let h=0;const f=[];for(let w=0;w<r;w++){if(!this.areaContainsColour(t,h,l,this.accuracy,this.blockHeight)){f.push({startX:h,startY:l,fill:!1,blockWidth:this.accuracy,merged:!1}),h+=this.accuracy;continue}if(f.push({startX:h,startY:l,fill:!0,blockWidth:this.accuracy,merged:!1}),h+=this.accuracy,h>=o)break}if(u.push(f),l+=this.blockHeight,l>=s)break}this.mergeColumns(u);const d=[];for(const m of u){const h=m.filter(f=>!f.merged&&f.fill);d.push(h)}return this.splitIntoRandomLengthBlocks(d,n,i,c)}mergeColumns(t){for(let o=0;o<t.length;o++){let s=!1,e=0,r=-1;for(let n=0;n<t[o].length;n++){const i=t[o][n].fill;if(i&&s){const c=t[o][n];c.merged=!0;const l=t[o][r];l.blockWidth=e+this.accuracy,e=l.blockWidth,s=!0;continue}if(i){const c=t[o][n];r=n,e=c.blockWidth,s=!0,c.merged=!1;continue}e=0,s=!1,r=-1}}}splitIntoRandomLengthBlocks(t,o,s,e){const r=[];for(let n=0;n<t.length;n++){const i=[];for(let c=0;c<t[n].length;c++){const l=t[n][c].blockWidth,u=this.randomNumbersWithSum(l,o,s,e);let d=t[n][c].startX;for(let g=0;g<u.length;g++){const m=u[g],h={fill:!0,merged:!0,startY:t[n][c].startY,startX:d,blockWidth:m};d+=m,i.push(h)}}r.push(i)}return r}areaContainsColour(t,o,s,e,r){const n=t.getImageData(o,s+Math.floor(r/2),e,1).data;let i=!1;for(let c=0;c<n.length;c+=4){const l=n[c],u=n[c+1],d=n[c+2];if(n[c+3]!==0&&(l<255||u<255||d<255)){i=!0;break}}return i}generateCodeBlocks(t){const o=[];for(let s=0;s<t.length;s++)for(let e=0;e<t[s].length;e++)if(t[s][e].fill){const n=this.createRectangle(t[s][e].startX,t[s][e].startY,t[s][e].blockWidth,this.blockHeight,this.codeBlockMinWidth,this.codeBlockMaxWidth);o.push(n)}return o}createRectangle(t,o,s,e,r,n){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width",(s-this.spacing).toString()),i.setAttribute("height",(e-this.spacing).toString()),i.setAttribute("x",t.toString()),i.setAttribute("y",o.toString());const c=this.calculateRectClassName(s,r,n);return i.setAttribute("class",c),i}calculateRectClassName(t,o,s){let e="";do{if(t===o){e=this.chooseRandomString(["parenthesis","space"]);continue}if(t===s){e=this.chooseRandomString(["comment","function"]);continue}e=this.chooseRandomString(["access-modifier","primitive-type","conditional-statement","jump-statement","variable-declaration-const","variable-declaration-let"])}while(this.previousClassName===e);return this.previousClassName=e,e}chooseRandomString(t){const o=Math.floor(Math.random()*t.length);return t[o]}randomNumbersWithSum(t,o,s,e){let r=[];if(e){const c=Math.floor(t/o);r=Array.from(Array(c).keys()).map(l=>l*o)}else r=Array.from(Array(t).keys());const n=[];let i=t;for(;i>o;){if(i<o*2){n.push(i);break}const c=this.generateRandomNumber(r,o,s);n.push(c),i-=c}return n}generateRandomNumber(t,o,s){let e;do{const r=Math.floor(Math.random()*t.length);e=t[r]}while(e<o||e>s);return e}}const v=1,x=5,S=5,B=30,N=2,I=new C(v,x,S,B,N,!0);I.createFromImageSrc("/wales.svg","output").then(()=>{});
